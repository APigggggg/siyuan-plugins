"use strict";var re=Object.defineProperty;var oe=(e,t,i)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var O=(e,t,i)=>(oe(e,typeof t!="symbol"?t+"":t,i),i);const ne=require("siyuan");var se=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof require<"u"?require:t)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),ae=Object.defineProperty,le=(e,t,i)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ce=(e,t,i)=>(le(e,typeof t!="symbol"?t+"":t,i),i),ue=Object.defineProperty,he=(e,t,i)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,a=(e,t,i)=>(he(e,typeof t!="symbol"?t+"":t,i),i),ge=Object.defineProperty,pe=(e,t,i)=>t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,T=(e,t,i)=>(pe(e,typeof t!="symbol"?t+"":t,i),i),X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},U={},de={get exports(){return U},set exports(e){U=e}};(function(e){(function(t,i){e.exports?e.exports=i():t.log=i()})(X,function(){var t=function(){},i="undefined",r=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function n(l,w){var m=l[w];if(typeof m.bind=="function")return m.bind(l);try{return Function.prototype.bind.call(m,l)}catch{return function(){return Function.prototype.apply.apply(m,[l,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(l){return l==="debug"&&(l="log"),typeof console===i?!1:l==="trace"&&r?h:console[l]!==void 0?n(console,l):console.log!==void 0?n(console,"log"):t}function g(l,w){for(var m=0;m<o.length;m++){var u=o[m];this[u]=m<l?t:this.methodFactory(u,l,w)}this.log=this.debug}function L(l,w,m){return function(){typeof console!==i&&(g.call(this,w,m),this[l].apply(this,arguments))}}function s(l,w,m){return d(l)||L.apply(this,arguments)}function f(l,w,m){var u=this,k;w=w??"WARN";var p="loglevel";typeof l=="string"?p+=":"+l:typeof l=="symbol"&&(p=void 0);function C(c){var E=(o[c]||"silent").toUpperCase();if(!(typeof window===i||!p)){try{window.localStorage[p]=E;return}catch{}try{window.document.cookie=encodeURIComponent(p)+"="+E+";"}catch{}}}function x(){var c;if(!(typeof window===i||!p)){try{c=window.localStorage[p]}catch{}if(typeof c===i)try{var E=window.document.cookie,D=E.indexOf(encodeURIComponent(p)+"=");D!==-1&&(c=/^([^;]+)/.exec(E.slice(D))[1])}catch{}return u.levels[c]===void 0&&(c=void 0),c}}function F(){if(!(typeof window===i||!p)){try{window.localStorage.removeItem(p);return}catch{}try{window.document.cookie=encodeURIComponent(p)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}u.name=l,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=m||s,u.getLevel=function(){return k},u.setLevel=function(c,E){if(typeof c=="string"&&u.levels[c.toUpperCase()]!==void 0&&(c=u.levels[c.toUpperCase()]),typeof c=="number"&&c>=0&&c<=u.levels.SILENT){if(k=c,E!==!1&&C(c),g.call(u,c,l),typeof console===i&&c<u.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+c},u.setDefaultLevel=function(c){w=c,x()||u.setLevel(c,!1)},u.resetLevel=function(){u.setLevel(w,!1),F()},u.enableAll=function(c){u.setLevel(u.levels.TRACE,c)},u.disableAll=function(c){u.setLevel(u.levels.SILENT,c)};var b=x();b==null&&(b=w),u.setLevel(b,!1)}var y=new f,v={};y.getLogger=function(l){if(typeof l!="symbol"&&typeof l!="string"||l==="")throw new TypeError("You must supply a name when creating a logger.");var w=v[l];return w||(w=v[l]=new f(l,y.getLevel(),y.methodFactory)),w};var j=typeof window!==i?window.log:void 0;return y.noConflict=function(){return typeof window!==i&&window.log===y&&(window.log=j),y},y.getLoggers=function(){return v},y.default=y,y})})(de);var A={},fe={get exports(){return A},set exports(e){A=e}};(function(e){(function(t,i){e.exports?e.exports=i():t.prefix=i(t)})(X,function(t){var i=function(s){for(var f=1,y=arguments.length,v;f<y;f++)for(v in arguments[f])Object.prototype.hasOwnProperty.call(arguments[f],v)&&(s[v]=arguments[f][v]);return s},r={template:"[%t] %l:",levelFormatter:function(s){return s.toUpperCase()},nameFormatter:function(s){return s||"root"},timestampFormatter:function(s){return s.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},o,n={},h=function(s){if(!s||!s.getLogger)throw new TypeError("Argument is not a root logger");o=s},d=function(s,f){if(!s||!s.setLevel)throw new TypeError("Argument is not a logger");var y=s.methodFactory,v=s.name||"",j=n[v]||n[""]||r;function l(w,m,u){var k=y(w,m,u),p=n[u]||n[""],C=p.template.indexOf("%t")!==-1,x=p.template.indexOf("%l")!==-1,F=p.template.indexOf("%n")!==-1;return function(){for(var b="",c=arguments.length,E=Array(c),D=0;D<c;D++)E[D]=arguments[D];if(v||!n[u]){var q=p.timestampFormatter(new Date),B=p.levelFormatter(w),H=p.nameFormatter(u);p.format?b+=p.format(B,H,q):(b+=p.template,C&&(b=b.replace(/%t/,q)),x&&(b=b.replace(/%l/,B)),F&&(b=b.replace(/%n/,H))),E.length&&typeof E[0]=="string"?E[0]=b+" "+E[0]:E.unshift(b)}k.apply(void 0,E)}}return n[v]||(s.methodFactory=l),f=f||{},f.template&&(f.format=void 0),n[v]=i({},j,f),s.setLevel(s.getLevel()),o||s.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),s},g={reg:h,apply:d},L;return t&&(L=t.prefix,g.noConflict=function(){return t.prefix===g&&(t.prefix=L),g}),g})})(fe);var N=class{};T(N,"LOG_LEVEL_KEY","VITE_LOG_LEVEL"),T(N,"LOG_PREFIX_KEY","VITE_LOG_PREFIX");var _=(e=>(e.LOG_LEVEL_DEBUG="DEBUG",e.LOG_LEVEL_INFO="INFO",e.LOG_LEVEL_WARN="WARN",e.LOG_LEVEL_ERROR="ERROR",e))(_||{});function ye(){const e=Error.prepareStackTrace;Error.prepareStackTrace=(i,r)=>r;const t=new Error().stack.slice(1);return Error.prepareStackTrace=e,t}var z=class{static stringToEnumValue(e,t){return e[Object.keys(e).filter(i=>e[i].toString()===t)[0]]}static getEnvLevel(e){if(!e)return;const t=e.getEnvOrDefault(N.LOG_LEVEL_KEY,_.LOG_LEVEL_INFO),i=z.stringToEnumValue(_,t.toUpperCase());return i||console.warn("[zhi-log] LOG_LEVEL is invalid in you .env file.Must be either debug, info, warn or error, fallback to default info level"),i}static getEnvLogger(e){if(e)return e.getEnv(N.LOG_PREFIX_KEY)}},we=class{constructor(e,t,i){T(this,"consoleLogger","console"),T(this,"stackSize",1),T(this,"getLogger",n=>{let h;if(n)h=n;else{const d=ye(),g=[],L=[];for(let s=0;s<d.length;s++){const f=d[s],y=f.getFileName()??"none";if(s>this.stackSize-1)break;const v=y+"-"+f.getLineNumber()+":"+f.getColumnNumber();g.push(v)}L.length>0&&(h=g.join(" -> "))}return(!h||h.trim().length===0)&&(h=this.consoleLogger),U.getLogger(h)}),this.stackSize=1;let r;e?r=e:r=z.getEnvLevel(i),r=r??_.LOG_LEVEL_INFO,U.setLevel(r);const o={gray:n=>n.toString(),green:n=>n.toString(),yellow:n=>n.toString(),red:n=>n.toString()};A.reg(U),A.apply(U,{format(n,h,d){const g=["["+(t??z.getEnvLogger(i)??"zhi")+"]"];switch(g.push(o.gray("[")+o.green(d).toString()+o.gray("]")),n){case _.LOG_LEVEL_DEBUG:g.push(o.gray(n.toUpperCase().toString()));break;case _.LOG_LEVEL_INFO:g.push(o.green(n.toUpperCase().toString()));break;case _.LOG_LEVEL_WARN:g.push(o.yellow(n.toUpperCase().toString()));break;case _.LOG_LEVEL_ERROR:g.push(o.red(n.toUpperCase().toString()));break}return g.push(o.green(h).toString()),g.push(o.gray(":")),g.join(" ")}})}setStackSize(e){this.stackSize=e??1}},me=class{constructor(e,t,i){T(this,"logger"),this.logger=new we(e,t,i)}getLogger(e,t){return this.logger.setStackSize(t),this.logger.getLogger(e)}},$=class extends me{constructor(e,t,i){super(e,t,i)}getLogger(e,t){return super.getLogger(e,t)}},Q=class{static defaultLogger(e,t){return Q.customLogFactory(void 0,void 0,e).getLogger(void 0,t)}static customLogFactory(e,t,i){return new $(e,t,i)}static customSignLogFactory(e,t){return new $(void 0,e,t)}},ee=class{};a(ee,"LOG_STACK_SIZE",1);var te="1.0.11",ve=class{constructor(){a(this,"VERSION"),this.VERSION=te}},Ee=class{constructor(){a(this,"VERSION"),this.VERSION=te}},P=class{constructor(){a(this,"getQueryString",e=>{if(!P.isInBrowser)return"";const t=window.location.search.substring(1).split("&");for(let i=0;i<t.length;i++){const r=t[i].split("=");if(r[0]===e)return r[1]}return""})}static isInChromeExtension(){return P.isInBrowser?window.location.href.indexOf("chrome-extension://")>-1:!1}},S=P;a(S,"isInBrowser",typeof window<"u"),a(S,"isElectron",()=>!P.isInBrowser||!window.navigator||!window.navigator.userAgent?!1:/Electron/.test(window.navigator.userAgent)),a(S,"replaceUrlParam",(e,t,i)=>{i==null&&(i="");const r=new RegExp("\\b("+t+"=).*?(&|#|$)");return e.search(r)>=0?e.replace(r,"$1"+i+"$2"):(e=e.replace(/[?#]$/,""),e+(e.indexOf("?")>0?"&":"?")+t+"="+i)}),a(S,"setUrlParameter",(e,t,i)=>P.isInBrowser?e.includes(t)?P.replaceUrlParam(e,t,i):(e+=(e.match(/[?]/g)!=null?"&":"?")+t+"="+i,e):""),a(S,"reloadTabPage",e=>{setTimeout(function(){if(P.isInBrowser){const t=window.location.href;window.location.href=P.setUrlParameter(t,"tab",e)}},200)}),a(S,"reloadPage",()=>{setTimeout(function(){P.isInBrowser&&window.location.reload()},200)}),a(S,"reloadPageWithMessageCallback",(e,t)=>{t&&t(),setTimeout(function(){P.isInBrowser&&window.location.reload()},200)});var M=class{constructor(){a(this,"isInSiyuanWidget",()=>typeof window>"u"?!1:window.frameElement!=null&&window.frameElement.parentElement!=null&&window.frameElement.parentElement.parentElement!=null&&window.frameElement.parentElement.parentElement.getAttribute("data-node-id")!==""),a(this,"isInSiyuanNewWin",()=>typeof window>"u"?!1:typeof window.terwer<"u"),a(this,"isInSiyuanOrSiyuanNewWin",()=>S.isElectron)}siyuanWindow(){let e;return this.isInSiyuanWidget()?e=parent.window:this.isInSiyuanNewWin()||typeof window<"u"?e=window:e=void 0,e}},be=class{constructor(){a(this,"serverApi"),a(this,"clientApi"),a(this,"siyuanUtil"),this.serverApi=new ve,this.clientApi=new Ee,this.siyuanUtil=new M}},Le=class{constructor(){a(this,"VERSION"),this.VERSION="1.0.0"}},Se=class{f(e,...t){let i=e;for(let r=0;r<t.length;r++){const o=t[r];typeof o=="string"?i=i.replace(`{${r}}`,o):i=i.replace(`{${r}}`,o.toString())}return i}},Pe=class{constructor(){a(this,"TIME_SPLIT"," "),a(this,"formatIsoToZhDate",(e,t,i)=>{if(!e)return"";let r=e;const o=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,n=r.match(o);if(n==null)return e;for(let h=0;h<n.length;h++){const d=n[h];let g=d;t&&(g=this.addHoursToDate(new Date(d),8).toISOString());const L=g.split("T"),s=L[0],f=L[1].split(".")[0];let y=s+this.TIME_SPLIT+f;i&&(y=s),r=r.replace(d,y)}return r})}addHoursToDate(e,t){return e.setTime(e.getTime()+t*60*60*1e3),e}nowZh(){return this.formatIsoToZhDate(new Date().toISOString())}nowDateZh(){return this.formatIsoToZhDate(new Date().toISOString(),!0,!0)}nowTimeZh(){return this.formatIsoToZhDate(new Date().toISOString(),!0).split(this.TIME_SPLIT)[1]}},V=(e,t)=>{const i=Z(e),r=Z(t),o=i.pop(),n=r.pop(),h=J(i,r);return h!==0?h:o&&n?J(o.split("."),n.split(".")):o||n?o?-1:1:0},Oe=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Z=e=>{if(typeof e!="string")throw new TypeError("Invalid argument expected string");const t=e.match(Oe);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},K=e=>e==="*"||e==="x"||e==="X",Y=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},_e=(e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t],De=(e,t)=>{if(K(e)||K(t))return 0;const[i,r]=_e(Y(e),Y(t));return i>r?1:i<r?-1:0},J=(e,t)=>{for(let i=0;i<Math.max(e.length,t.length);i++){const r=De(e[i]||"0",t[i]||"0");if(r!==0)return r}return 0},Ie=class{greater(e,t){return V(e,t)>0}equal(e,t){return V(e,t)===0}lesser(e,t){return V(e,t)<0}},Ue=class{static getDevice(){const e=new M;return e.isInSiyuanWidget()?"Siyuan_Widget":e.isInSiyuanOrSiyuanNewWin()?"Siyuan_NewWin":S.isInChromeExtension()?"Chrome_Extension":"Chrome_Browser"}},Te=class{constructor(){a(this,"siyuanUtil"),a(this,"requireLib",e=>{const t=this.siyuanUtil.siyuanWindow();return t?t.require(e):se(e)}),a(this,"getCrossPlatformAppDataFolder",()=>{var e,t,i,r,o,n;const h=this.requireLib("path");let d;return((e=this.syProcess())==null?void 0:e.platform)==="darwin"?d=h.join((t=this.syProcess())==null?void 0:t.env.HOME,"/Library/Application Support"):((i=this.syProcess())==null?void 0:i.platform)==="win32"?d=(r=this.syProcess())==null?void 0:r.env.APPDATA:((o=this.syProcess())==null?void 0:o.platform)==="linux"&&(d=(n=this.syProcess())==null?void 0:n.env.HOME),d}),this.siyuanUtil=new M}copyFolderSync(e,t){const i=this,r=this.requireLib("fs"),o=this.requireLib("path");r.existsSync(t)||r.mkdirSync(t),r.lstatSync(e).isDirectory()&&r.readdirSync(e).forEach(function(n){const h=o.join(e,n);r.lstatSync(h).isDirectory()?i.copyFolderSync(h,o.join(t,n)):r.copyFileSync(h,o.join(t,n))})}rmFolder(e){const t=this.requireLib("fs");t.existsSync(e)&&t.rmdirSync(e,{recursive:!0})}joinPath(...e){return this.requireLib("path").join(...e)}dirname(e){return this.requireLib("path").dirname(e)}absPath(e){const t=this.requireLib("path"),i=this.dirname(e);return t.resolve(t.dirname(i),e)}syProcess(){return S.isInBrowser?window.process:process}siyuanConfPath(){const e=this.siyuanUtil.siyuanWindow();if(!e)throw new Error("Not in siyuan env");return e==null?void 0:e.siyuan.config.system.confDir}siyuanDataPath(){const e=this.siyuanUtil.siyuanWindow();if(!e)throw new Error("Not in siyuan env");return e.siyuan.config.system.dataDir}siyuanAppearancePath(){return this.requireLib("path").join(this.siyuanConfPath(),"appearance")}siyuanThemePath(){return this.requireLib("path").join(this.siyuanAppearancePath(),"themes")}zhiThemePath(){return this.requireLib("path").join(this.siyuanThemePath(),"zhi")}zhiThemeDistPath(){return this.requireLib("path").join(this.zhiThemePath(),"apps","theme","dist")}zhiBlogDistPath(){return this.requireLib("path").join(this.siyuanThemePath(),"apps","blog","dist")}zhiMiniPath(){return this.requireLib("path").join(this.siyuanThemePath(),"zhi-mini")}},ke=class{constructor(){a(this,"strUtil"),a(this,"dateUtil"),a(this,"electronUtil"),a(this,"browserUtil"),a(this,"versionUtil"),a(this,"deviceUtil"),this.strUtil=new Se,this.dateUtil=new Pe,this.electronUtil=new Te,this.browserUtil=S,this.versionUtil=new Ie,this.deviceUtil=Ue}},xe=class{constructor(e){a(this,"env"),a(this,"logger"),a(this,"siyuanApi"),a(this,"blogApi"),a(this,"common"),this.env=e,this.logger=Q.defaultLogger(this.env,ee.LOG_STACK_SIZE),this.siyuanApi=new be,this.blogApi=new Le,this.common=new ke}getEnv(){if(!this.env)throw new Error("env is not initiated, please use new ZhiSdk(env) create ZhiSdk object!");return this.env}getLogger(){return this.logger}},I=class{static zhiSdk(e){if(!I.zhiSdkObj){I.zhiSdkObj=new xe(e);const t=I.zhiSdkObj.getLogger(),i=I.zhiSdkObj.common;t.info(i.strUtil.f("ZhiSdk inited, components are available now,like logger, env and so on."))}return I.zhiSdkObj}},W=I;ce(W,"zhiSdkObj");var Ae=Object.defineProperty,Ne=(e,t,i)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,G=(e,t,i)=>(Ne(e,typeof t!="symbol"?t+"":t,i),i),R=class{};G(R,"NODE_ENV_KEY","NODE_ENV"),G(R,"VITE_DEBUG_MODE_KEY","VITE_DEBUG_MODE");var ie=class{constructor(e){G(this,"envMeta"),this.envMeta=e}isNodeDev(){return this.getEnv(R.NODE_ENV_KEY)==="development"}isDev(){return this.isNodeDev()||this.getBooleanEnv(R.VITE_DEBUG_MODE_KEY)}getEnv(e){let t;try{this.envMeta[e]&&(t=this.envMeta[e])}catch(i){console.error(i)}return t}getStringEnv(e){return this.getEnv(e)??""}getBooleanEnv(e){let t=!1;return this.getEnv(e)&&(t=this.getStringEnv(e).toLowerCase()==="true"),t}getEnvOrDefault(e,t){const i=this.getStringEnv(e);return i.trim().length==0?t:i}};class Re{constructor(){O(this,"REPO_HASH","1c968d1044aa4d0cfe9be1ad122c2ab5bc1e8e5e");O(this,"logger");O(this,"common");O(this,"siyuanUtil");O(this,"initMethods",{initLocalStorageMethod:t=>{const i=this.siyuanUtil.siyuanWindow(),r=this.common.electronUtil.siyuanDataPath();if(i.JsonLocalStorage){this.logger.warn("JsonLocalStorage loaded, ignore.",t);return}this.common.electronUtil.requireLib(`${r}/widgets/sy-post-publisher/lib/json-localstorage/json-localstorage.js`).init("../../../../storage/syp/")},initSlotMethod:()=>{const t=this.common.electronUtil.siyuanDataPath();this.common.electronUtil.requireLib(`${t}/widgets/sy-post-publisher/lib/siyuan/silot.js`)()},initThemeAdaptor:t=>{const i=this.siyuanUtil.siyuanWindow(),r=this.common.electronUtil.siyuanDataPath();if(i.customstyle){this.logger.warn("customstyle loaded, ignore.",t);return}const o=this.common.electronUtil.requireLib(`${r}/widgets/sy-post-publisher/lib/siyuan/theme.js`);setTimeout(o,3e3)},initPublishHelper:t=>{const i=this.siyuanUtil.siyuanWindow(),r=this.common.electronUtil.siyuanDataPath();if(i.syp){console.warn("syp已挂载，忽略",t);return}this.common.electronUtil.requireLib(`${r}/widgets/sy-post-publisher/lib/siyuan/publish-helper.js`)()},initPicgoExtension:t=>{const i=this.siyuanUtil.siyuanWindow(),r=this.common.electronUtil.siyuanDataPath();if(i.SyPicgo){console.warn("SyPicgo loaded, ignore.",t);return}const o=this.common.electronUtil.requireLib(`${r}/widgets/sy-post-publisher/lib/picgo/syPicgo.js`).default,n=this.common.electronUtil.getCrossPlatformAppDataFolder(),h=`${r}/widgets/sy-post-publisher/lib/picgo/picgo.cfg.json`,d=o.joinPath(n,"sy-picgo"),g="picgo.cfg.json",L=o.joinPath(d,g);o.upgradeCfg(h,d,g),this.logger.warn("PicGO配置文件初始化为=>",L);const s=o.initPicgo(L);i.SyPicgo=s,this.logger.debug("syPicgo=>",s)},initCmder:t=>{const i=this.siyuanUtil.siyuanWindow(),r=this.common.electronUtil.siyuanDataPath();if(i.SyCmd){this.logger.warn("SyCmd已挂载，忽略",t);return}const o=this.common.electronUtil.requireLib(`${r}/widgets/sy-post-publisher/lib/cmd/syCmd.js`);i.SyCmd=o,this.logger.debug("syCmd=>",o)}});O(this,"doInit",()=>{this.initMethods.initLocalStorageMethod("PublisherHook"),this.initMethods.initSlotMethod(),this.initMethods.initThemeAdaptor("PublisherHook"),this.initMethods.initPublishHelper("PublisherHook"),this.initMethods.initPicgoExtension("PublisherHook"),this.initMethods.initCmder("PublisherHook")});const t=new ie({VITE_LOG_LEVEL:"DEBUG",VITE_DEBUG_MODE:"true",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}),i=W.zhiSdk(t);this.logger=i.getLogger(),this.common=i.common,this.siyuanUtil=i.siyuanApi.siyuanUtil,this.REPO_HASH="1c968d1044aa4d0cfe9be1ad122c2ab5bc1e8e5e"}async doDownload(){this.logger.warn("Downloading sy-post-publisher from bazaar...");const t="/api/bazaar/installBazaarWidget",i={repoURL:"https://github.com/terwer/sy-post-publisher",packageName:"sy-post-publisher",repoHash:this.REPO_HASH,mode:0},r={body:JSON.stringify(i),method:"POST"};if((await(await fetch(t,r)).json()).code==0)this.logger.info("Download sy-post-publisher from bazaar success");else throw new Error("Download sy-post-publisher error, this plugin will not work!")}async init(){this.logger.info("Initiating sy-post-publisher ...");try{const i=`${this.common.electronUtil.siyuanDataPath()}/widgets/sy-post-publisher`,r=this.common.electronUtil.requireLib("fs");this.logger.info("Widget sy-post-publisher folder=>",i),r.existsSync(i)||(this.logger.warn("Widget sy-post-publisher not exist, downloading..."),await this.doDownload(),this.logger.warn("Widget sy-post-publisher downloaded")),this.doInit()}catch(t){this.logger.warn("Failed to init sy-post-publisher，it may not work in some case.Error=>",t)}}}class je extends ne.Plugin{constructor(){super();O(this,"logger");O(this,"publisherHook");const i=new ie({VITE_LOG_LEVEL:"DEBUG",VITE_DEBUG_MODE:"true",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}),r=W.zhiSdk(i);this.logger=r.getLogger(),this.publisherHook=new Re}async onload(){await this.publisherHook.init(),this.logger.info("ZhiPublisherPlugin loaded")}onunload(){this.logger.info("ZhiPublisherPlugin unloaded")}}module.exports=je;
